<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Deploy Custom Content In Microsoft Sentinel Using Repositories - NETSOC Cybersecurity</title><meta name=Description content="Premier MDR & Consulting Services"><meta property="og:title" content="Deploy Custom Content In Microsoft Sentinel Using Repositories"><meta property="og:description" content="Introduction It can be stressful managing multiple workspaces in Microsoft Sentinel, especially when it comes to having to manually deploy analytic rules in large enterprise environments with multiple tenants. This feature is incredibly useful for Managed Security Service Providers who manage multiple workspaces. With Microsoft Sentinel Repositories, we can deploy and manage custom content from a central repository across multiple workspaces at ease.
Originally this article was written in early 2022 when Microsoft Sentinel Repositories was released."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/"><meta property="og:image" content="https://blog.netsoc.us/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-27T06:15:03+00:00"><meta property="article:modified_time" content="2022-09-27T09:27:50-04:00"><meta property="og:site_name" content="Premier MDR & Consulting Services"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.netsoc.us/logo.png"><meta name=twitter:title content="Deploy Custom Content In Microsoft Sentinel Using Repositories"><meta name=twitter:description content="Introduction It can be stressful managing multiple workspaces in Microsoft Sentinel, especially when it comes to having to manually deploy analytic rules in large enterprise environments with multiple tenants. This feature is incredibly useful for Managed Security Service Providers who manage multiple workspaces. With Microsoft Sentinel Repositories, we can deploy and manage custom content from a central repository across multiple workspaces at ease.
Originally this article was written in early 2022 when Microsoft Sentinel Repositories was released."><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Deploy Custom Content In Microsoft Sentinel Using Repositories","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.netsoc.us\/deploy-custom-content-in-microsoft-sentinel-using-repositories\/"},"genre":"posts","wordcount":672,"url":"https:\/\/blog.netsoc.us\/deploy-custom-content-in-microsoft-sentinel-using-repositories\/","datePublished":"2022-09-27T06:15:03+00:00","dateModified":"2022-09-27T09:27:50-04:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"NETSOC Cybersecurity"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="NETSOC Cybersecurity"><img class="lazyload logo" src=/svg/loading.min.svg data-src=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png data-srcset="https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png, https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png 1.5x, https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png 2x" data-sizes=auto alt=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png title=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=https://netsoc.us rel="noopener noreffer" target=_blank>Return Home </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="NETSOC Cybersecurity"><img class="lazyload logo" src=/svg/loading.min.svg data-src=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png data-srcset="https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png, https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png 1.5x, https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png 2x" data-sizes=auto alt=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png title=https://netsoc.us/wp-content/uploads/2022/09/NETSOC-logo-White.png></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=https://netsoc.us title rel="noopener noreffer" target=_blank>Return Home</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Deploy Custom Content In Microsoft Sentinel Using Repositories</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://netsoc.us title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>NETSOC Cybersecurity</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-09-27>2022-09-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;672 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#additional-prerequisites>Additional Prerequisites</a></li></ul><ul><li><a href=#creating-connections>Creating Connections</a></li><li><a href=#example>Example</a></li></ul></nav></div></div><div class=content id=content><h1 id=introduction>Introduction</h1><p>It can be stressful managing multiple workspaces in Microsoft Sentinel, especially when it comes to having to manually deploy analytic rules in large enterprise environments with multiple tenants. This feature is incredibly useful for Managed Security Service Providers who manage multiple workspaces. With Microsoft Sentinel Repositories, we can deploy and manage custom content from a central repository across multiple workspaces at ease.</p><p>Originally this article was written in early 2022 when Microsoft Sentinel Repositories was released. This feature is still in public preview and can be referenced here: <a href="https://learn.microsoft.com/en-us/azure/sentinel/ci-cd?tabs=github" target=_blank rel="noopener noreffer">https://learn.microsoft.com/en-us/azure/sentinel/ci-cd?tabs=github</a></p><h1 id=prerequisites>Prerequisites</h1><p>Sentinel supports connections to GitHub and Azure DevOps repositories. According to Microsoft the following permissions are required to connect a Microsoft Sentinel workspace to your source control repository:</p><ul><li>Resource Group Owner or both the User Access Administrator and Sentinel Contributer roles</li><li>Contributer access to the code repository in GitHub or Azure DevOps</li><li>Actions enabled for GitHub and Pipeliens enabled for Azure Devops</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927081028648.png data-srcset="/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927081028648.png, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927081028648.png 1.5x, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927081028648.png 2x" data-sizes=auto alt=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927081028648.png title=image-20220927081028648></p><p>Pro tip: For the MSSPs and multi-tenant scenarios leveraging Azure Lighthouse, it&rsquo;s recommended assigning these roles to a group in your ARM template prior to deploying Azure Lighthouse. The role definition ids can be found here: <a href=https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles target=_blank rel="noopener noreffer">https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles</a></p><h2 id=additional-prerequisites>Additional Prerequisites</h2><p>Additionally, to deploy custom content it&rsquo;s required to have Actions enabled for GitHub and Pipelines enabled for Azure DevOps. Although there is a plethora of .yml files in the Microsoft Sentinel Public GitHub Repository, custom content can only be deployed via Azure Resource Manager (ARM) templates.</p><p>Pro tip: It is extremely useful to leverage a separate workspace as a model tenant to build, test, stage, and export custom content as ARM templates in Microsoft Sentinel.</p><p>![Untitled picture2](/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/Untitled picture2.png)</p><h1 id=deploying-content>Deploying Content</h1><p>For the purpose of this demonstration we&rsquo;ll be deploying Analytic Rules, but the following content types can be selected when creating a new connection in Repositories:</p><ul><li>Analytic Rules</li><li>Automation Rules</li><li>Hunting Queries</li><li>Parsers</li><li>Playbooks</li><li>Workbooks</li></ul><h2 id=creating-connections>Creating Connections</h2><p>At the time of writing there were too many cross-tenant limitations which existed when connecting Azure DevOps so this demonstration was done using GitHub. If you decide to use Azure DevOps, please note that if you&rsquo;re creating the connection as a guest user the AzureDevOps URL must be entered manually and will not appear in the dropdown.</p><p>Be sure to be signed into either GitHub or Azure DevOps to connect a repository and in Microsoft Sentinel, under Content Management, select Repositories in the Sentinel workspace where you wish to deploy content.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927080432943.png data-srcset="/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927080432943.png, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927080432943.png 1.5x, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927080432943.png 2x" data-sizes=auto alt=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927080432943.png title=image-20220927080432943></p><p>Make sure you&rsquo;re signed into the account which has been assigned the proper permissions, select &ldquo;Add new&rdquo;, and Create a new connection.</p><p>Name the connection and if necessary provide a description, next authorize your Source control application. Once you&rsquo;ve authorized either GitHub or AzureDevOps select a repository, branch, and select the Content types and hit create.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927082536123.png data-srcset="/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927082536123.png, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927082536123.png 1.5x, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927082536123.png 2x" data-sizes=auto alt=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927082536123.png title=image-20220927082536123></p><p>This connection will create a workflow rule in your source repository and begin to deploy or update any existing content specified in the rule. For the sake of this article, we&rsquo;re going to add the rule after we connect the repository.</p><h2 id=example>Example</h2><p>In the example below, we&rsquo;ll deploy a really simple analytic rule in which detects for failed login activity in an Active Directory network.</p><p>![Untitled picture](/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/Untitled picture.png)</p><p>Since we can only deploy content through Azure Resource Manager (ARM) templates in the form of .json files, it is recommended to first create the rule in a separate workspace and export it. You can do this by selecting the analytic rule and selecting the export button at the top.</p><p>Once you have the .json file ARM template, adding this rule to your source repository will immediately deploy to all of the connected workspaces.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927084908815.png data-srcset="/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927084908815.png, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927084908815.png 1.5x, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927084908815.png 2x" data-sizes=auto alt=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927084908815.png title=image-20220927084908815></p><p>Note that any changes to existing content will overwrite, any content matching the parameters to deploy will deploy to all workspaces connected to the workflow.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927085306366.png data-srcset="/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927085306366.png, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927085306366.png 1.5x, /posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927085306366.png 2x" data-sizes=auto alt=/posts/Deploy-Custom-Content-In-Microsoft-Sentinel-Using-Repositories.assets/image-20220927085306366.png title=image-20220927085306366></p><p>Pro tip: Making use of a naming convention to label your CICD content can be extremely helpful when managing content. When managing large rule sets with multiple workspaces, it&rsquo;s recommended making the required updates and changes to rules from the central repository to maintain consistency across the connected workspaces.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-09-27</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/ data-title="Deploy Custom Content In Microsoft Sentinel Using Repositories" data-via=https://netsoc.us><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/ data-title="Deploy Custom Content In Microsoft Sentinel Using Repositories"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/ data-title="Deploy Custom Content In Microsoft Sentinel Using Repositories"><i data-svg-src=/lib/simple-icons/icons/line.min.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://blog.netsoc.us/deploy-custom-content-in-microsoft-sentinel-using-repositories/ data-title="Deploy Custom Content In Microsoft Sentinel Using Repositories"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.104.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://netsoc.us target=_blank>NETSOC Cybersecurity</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>